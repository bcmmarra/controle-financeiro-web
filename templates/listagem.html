{% extends 'base.html' %}

{% block conteudo %}
<h2>Extrato de Transa√ß√µes</h2>

<div
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
    <h3 style="margin: 0; color: #2c3e50;">Hist√≥rico de Lan√ßamentos</h3>

    <form method="GET" action="/listagem" style="display: flex; gap: 8px;">
        <input type="text" name="busca" placeholder="üîç Buscar transa√ß√£o..." value="{{ request.args.get('busca', '') }}"
            style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 200px;">

        <input type="month" name="mes_filtro" value="{{ mes_atual }}"
            style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">

        <button type="submit"
            style="background: #3498db; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
            Filtrar
        </button>

        {% if request.args.get('busca') or request.args.get('mes_filtro') %}
        <a href="/listagem" style="padding: 8px; color: #e74c3c; text-decoration: none; font-size: 0.9em;">‚úñ Limpar</a>
        {% endif %}
    </form>
</div>

<table>
    <thead>
        <tr>
            <th>Data</th>
            <th>Descri√ß√£o</th>
            <th>Categoria</th>
            <th>M√©todo</th>
            <th>Valor</th>
            <th>Status</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>
    <tbody>
        {% for t in transacoes %}
        <tr>
            <td>{{ t.data_transacao.strftime('%d/%m/%Y') }}</td>
            <td>
                {{ t.descricao }}
                {% if t.is_parcelado %}
                <span class="parcela" style="color: #888; font-size: 0.85em;">({{ t.parcela_atual }}/{{
                    t.numero_parcelas }})</span>
                {% endif %}
            </td>
            <td>{{ t.categoria_nome }}</td>
            <td>{{ t.metodo_pagamento }}</td>
            <td>R$ {{ "%.2f"|format(t.valor_total) }}</td>
            <td style="text-align: center;">
                <a href="/alternar_pagamento/{{ t.id }}"
                    style="text-decoration: none; cursor: pointer; display: inline-block; padding: 5px 10px; border-radius: 4px; transition: background 0.2s;"
                    onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='transparent'"
                    title="Clique para alterar o status">

                    {% if t.pago %}
                    <span style="color: #27ae60; font-weight: bold;">‚óè Pago</span>
                    {% else %}
                    <span style="color: #e67e22; font-weight: bold;">‚óã Pendente</span>
                    {% endif %}
                </a>
            </td>
            <td>
                <a href="/editar/{{ t.id }}" style="text-decoration: none; color: #3498db; margin-right: 10px;"
                    title="Editar">‚úèÔ∏è</a>
                <a href="/deletar/{{ t.id }}" style="text-decoration: none; color: #e74c3c;"
                    onclick="return confirm('Deseja realmente excluir?')">üóëÔ∏è</a>
            </td>

            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" style="text-align: center; color: #999; padding: 30px;">Nenhuma transa√ß√£o encontrada para
                este per√≠odo.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}