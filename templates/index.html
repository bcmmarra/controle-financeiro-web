{% extends 'base.html' %}

{% block conteudo %}
<h2 style="color: #2c3e50; margin-bottom: 25px;">Resumo Financeiro - {{ datetime_now.strftime('%B') }}</h2>

{% if total_atrasadas > 0 %}
<div style="background: #fff5f5; border: 1px solid #feb2b2; color: #c53030; padding: 15px; border-radius: 12px; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
    <i class="fas fa-exclamation-triangle"></i>
    <span>Você possui <strong>{{ total_atrasadas }}</strong> conta(s) pendente(s) de meses ou dias anteriores.</span>
    <a href="/listagem" style="margin-left: auto; color: #c53030; font-weight: bold; text-decoration: underline;">Ver agora</a>
</div>
{% endif %}

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <div style="background: white; padding: 25px; border-radius: 12px; border-left: 5px solid #e74c3c; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: center;">
        <h6 style="color: #7f8c8d; font-size: 13px; font-weight: bold; margin-bottom: 15px;">PRÓXIMA CONTA</h6>
        {% if proxima_conta %}
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h2 style="margin: 0; color: #e74c3c;">R$ {{ "%.2f"|format(proxima_conta.valor_total) }}</h2>
                <p style="margin: 5px 0 0 0; color: #2c3e50; font-weight: bold;">{{ proxima_conta.descricao }}</p>
                <small style="color: #95a5a6;">Vence em: {{ proxima_conta.data_transacao.strftime('%d/%m') }}</small>
            </div>
            <a href="{{ url_for('quitar_proxima', id=proxima_conta.id) }}" 
               style="background: #27ae60; color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: 0.3s;"
               title="Marcar como pago">
                <i class="fas fa-check"></i>
            </a>
        </div>
        {% else %}
        <p style="color: #bdc3c7; font-style: italic; margin: 0;">Nenhuma conta pendente.</p>
        {% endif %}
    </div>

    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #f8f9fa; border-radius: 12px; border: 2px dashed #3498db; padding: 20px;">
        <p style="color: #3498db; margin-bottom: 15px; font-weight: bold;">Registrar novo gasto?</p>
        <a href="/novo_lancamento" style="background: #3498db; color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);">
            + Nova Transação
        </a>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-bottom: 30px;">
    
    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
        <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 18px;">Gastos por Categoria</h3>
        <div style="max-width: 250px; margin: 0 auto;">
            <canvas id="meuGrafico"></canvas>
        </div>
    </div>

    <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
        <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 18px;">Por Pagamento</h3>
        <div style="display: flex; flex-direction: column; gap: 15px;">
            {% for i in range(labels_metodos|length) %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #f8f9fa;">
                <span style="font-weight: bold; color: #7f8c8d;">{{ labels_metodos[i] }}</span>
                <span style="color: #2c3e50; font-weight: bold;">R$ {{ "%.2f"|format(valores_metodos[i]) }}</span>
            </div>
            {% endfor %}
            {% if not labels_metodos %}
                <p style="color: #bdc3c7; font-style: italic;">Sem lançamentos.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('meuGrafico').getContext('2d');
    const labelsParaGrafico = JSON.parse('{{ labels|tojson|safe }}');
    const valoresParaGrafico = JSON.parse('{{ valores|tojson|safe }}');
    const coresPadrao = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#8bc34a'];

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labelsParaGrafico,
            datasets: [{
                data: valoresParaGrafico,
                backgroundColor: coresPadrao,
                borderWidth: 2,
                hoverOffset: 15
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } },
            cutout: '72%'
        }
    });
</script>
{% endblock %}