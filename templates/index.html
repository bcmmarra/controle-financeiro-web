{% extends 'base.html' %}

{% block conteudo %}
<h2 style="color: #2c3e50; margin-bottom: 25px;">Resumo Financeiro - {{ datetime_now.strftime('%B') }}</h2>

<div style="display: flex; gap: 20px; margin-bottom: 30px;">
    <div style="flex: 1; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid #3498db;">
        <p style="margin: 0; color: #7f8c8d; font-size: 14px; font-weight: bold;">TOTAL DE GASTOS</p>
        <h2 style="margin: 10px 0 0 0; color: #2c3e50;">R$ {{ "%.2f"|format(gasto_mes) }}</h2>
    </div>

    <div style="flex: 1; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid #27ae60;">
        <p style="margin: 0; color: #7f8c8d; font-size: 14px; font-weight: bold;">TOTAL PAGO</p>
        <h2 style="margin: 10px 0 0 0; color: #27ae60;">R$ {{ "%.2f"|format(total_pago) }}</h2>
    </div>

    <div style="flex: 1; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid #e67e22;">
        <p style="margin: 0; color: #7f8c8d; font-size: 14px; font-weight: bold;">PENDENTE</p>
        <h2 style="margin: 10px 0 0 0; color: #e67e22;">R$ {{ "%.2f"|format(total_pendente) }}</h2>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <div style="background: white; padding: 25px; border-radius: 12px; border-left: 5px solid #e74c3c; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
        <small style="color: #888; font-weight: bold;">PRÓXIMO VENCIMENTO</small>
        {% if proxima_conta %}
            <h2 style="margin: 10px 0; color: #e74c3c;">R$ {{ "%.2f"|format(proxima_conta.valor_total) }}</h2>
            <p style="margin: 0; font-size: 0.9em; color: #555;"><strong>{{ proxima_conta.descricao }}</strong></p>
            <p style="margin: 0; font-size: 0.8em; color: #888;">{{ proxima_conta.data_transacao.strftime('%d/%m/%Y') }}</p>
        {% else %}
            <h2 style="margin: 10px 0; color: #bdc3c7;">Nenhuma conta</h2>
            <p style="margin: 0; font-size: 0.8em; color: #bdc3c7;">Tudo em dia!</p>
        {% endif %}
    </div>

    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #f8f9fa; border-radius: 12px; border: 2px dashed #3498db;">
        <p style="color: #3498db; margin-bottom: 15px; font-weight: bold;">Novo lançamento?</p>
        <a href="/novo_lancamento" style="background: #3498db; color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; transition: 0.3s;">+ Nova Transação</a>
    </div>
</div>

<div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px;">
    <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Distribuição por Categoria</h3>
    <div style="max-width: 350px; margin: 0 auto;">
        <canvas id="meuGrafico"></canvas>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('meuGrafico').getContext('2d');
    
    // O Jinja gera a string, e o JSON.parse transforma em Array/Lista de novo
    const labelsParaGrafico = JSON.parse('{{ labels|tojson|safe }}');
    const valoresParaGrafico = JSON.parse('{{ valores|tojson|safe }}');

    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labelsParaGrafico,
            datasets: [{
                data: valoresParaGrafico,
                backgroundColor: ['#3498db', '#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6', '#1abc9c', '#e67e22'],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' }
            },
            cutout: '70%'
        }
    });
</script>
{% endblock %}